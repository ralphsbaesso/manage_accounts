
%meta{content: "text/html; charset=UTF-8", "http-equiv" => "Content-Type"}/
%script{src: "https://www.gstatic.com/charts/loader.js", type: "text/javascript"}

= render 'transfers/filter', url: reports_path

.row
  .col-lg-12
    .panel.panel-default
      .panel-heading
        %h5.mb-0
          %button.btn.btn-link.collapsed{"aria-controls" => "div-collapse", "aria-expanded" => "false", "data-target" => "#div-collapse-grafico", "data-toggle" => "collapse"}
            GrÃ¡ficos
      #div-collapse-grafico.panel.panel-body.collapse.in
        .row
          .col-lg-6
            #piechart_negatives{style: "width: 100%; height: 500px; z-index: -1"}
          .col-lg-6
            #piechart_positives{style: "width: 100%; height: 500px;"}

.row
  .col-lg-12
    .panel.panel-default
      .panel-heading
        %h5.mb-0
          %button.btn.btn-link.collapsed{"aria-controls" => "div-collapse", "aria-expanded" => "false", "data-target" => "#div-collapse-table", "data-toggle" => "collapse"}
            Tabelas
      #div-collapse-table.panel.panel-body.collapse.in

        .row
          .col-lg-6
            .alert.alert-danger
              %table.table
                %thead
                  %tr
                    %th Item
                    %th Valor
                %tbody
                  - array = @negatives.clone
                  - array.shift
                  - total = 0
                  - array.each do |item|
                    - total += item[1]
                    %tr
                      %td= item[0]
                      %td= item[1]
                %tfoot
                  %tr
                    %th
                      %strong TOTAL
                    %th
                      %strong= total

          .col-lg-6
            .alert.alert-success
              %table.table
                %thead
                  %tr
                    %th Item
                    %th Valor
                %tbody
                  - array = @positives.clone
                  - array.shift
                  - total = 0
                  - array.each do |item|
                    - total += item[1]
                    %tr
                      %td= item[0]
                      %td= item[1]
                %tfoot
                  %tr
                    %th
                      %strong TOTAL
                    %th
                      %strong= total

:javascript

  var positives = JSON.parse('#{@positives.to_json.html_safe}');
  var negatives = JSON.parse('#{@negatives.to_json.html_safe}');

  for(var i = 1; i < negatives.length; i++){
    negatives[i][1] = parseFloat(negatives[i][1]);
  }

  for(var i = 1; i < positives.length; i++){
    positives[i][1] = parseFloat(positives[i][1]);
  }

  google.charts.load("current", {packages:["corechart"]});
  google.charts.setOnLoadCallback(drawChart);
  google.charts.setOnLoadCallback(drawChart2);

  function drawChart() {
    var data = google.visualization.arrayToDataTable(
      negatives
    );

    var options = {
      title: 'SALDO NEGATIVO',
      is3D: true,
    };

    var chart = new google.visualization.PieChart(document.getElementById('piechart_negatives'));
    chart.draw(data, options);
  }


  // google.charts.load("current", {packages:["corechart"]});
  // google.charts.setOnLoadCallback(drawChart);
  function drawChart2() {
    var data = google.visualization.arrayToDataTable(
      positives
    );

    var options = {
      title: 'SALDO POSITIVO',
      is3D: true,
    };

    var chart = new google.visualization.PieChart(document.getElementById('piechart_positives'));
    chart.draw(data, options);
  }